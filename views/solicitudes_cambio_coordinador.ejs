<%- include('includes/_nav_coordinador.ejs') %>
<%- include('includes/_header_coordinador.ejs') %>

<main class="bg-grey flex-grow-1 rounded-5 p-0 d-flex flex-column" style="height: 100vh;">
  <div class="mb-4">
    <h1 class="ms-3 mt-2">Solicitud de cambio</h1>
    <div style="border-bottom: 3px solid #84251C; width: 15rem; margin-top: -10px;"></div>
  </div>
  
  <!-- Contenedor de búsqueda y botones -->
  <div class="d-flex align-items-center justify-content-between mx-5 mb-3 gap-3 flex-wrap">
    <!-- Campo de búsqueda -->
    <div class="d-flex align-items-center flex-grow-1" style="max-width: 200px;">
      <input class="form-control me-2 rounded-pill" type="search" placeholder="Buscar profesor" aria-label="Search"
        style="background-image:url('/images/search.svg'); background-repeat:no-repeat; background-position: 1rem center; padding-left: 3rem; font-size: 1rem; width: 100%; border: 1px solid #84251C;">
    </div>
    
    <!-- Contenedor para los botones de la derecha -->
    <div class="d-flex gap-3">
      <button type="button" class="btn btn-outline-danger d-flex align-items-center gap-2 rounded-pill px-3 py-2">
        Ordenar por
      </button>
      <button type="button" class="btn btn-outline-danger d-flex align-items-center gap-2 rounded-pill px-3 py-2">
        Filtrar
      </button>
    </div>
  </div>
  <!-- Tabla de Solicitudes -->
<div class="table-responsive mx-5 mb-5 rounded-5 flex-grow-1" style="overflow: auto; background-color: white;">
  <table class="table table-hover" style="min-width: 800px; width: 100%;">
    <thead class="table-light">
      <tr>
        <th scope="col" class="text-center align-middle">ID Solicitud</th>
        <th scope="col" class="text-center align-middle">IVD ID</th>
        <th scope="col" class="text-center align-middle">Hora de Creación</th>
      
        <th scope="col" class="text-center align-middle"></th>
      </tr>
    </thead>
    <tbody>
      <% for (let solicitud of solicitudes) { %>
        <tr>
          <th scope="col" style="width: 30%; min-width: 100px;" class="text-center align-middle"><%= solicitud.solicitud_cambio_id %></th>
          <td scope="col" style="width: 30%; min-width: 100px;" class="text-center align-middle"><%= solicitud.ivd_id %></td>
          <td scope="col" style="width: 30%; min-width: 100px;" class="text-center align-middle">
            <%= new Date(solicitud.created_at).toLocaleTimeString('es-MX', {
              hour: '2-digit',
              minute: '2-digit',
              second: '2-digit'
            }) %>
          </td>
          <td cth scope="col" style="width: 10%; min-width: 50px;">
            <!-- Botón para ver detalles -->
            <button class="btn btn-sm p-0 d-flex align-items-center justify-content-center" 
              style="width: 1.5rem; height: 1.5rem; border-radius: 50%; background-color: #84251c; color: white; border: none;"
              data-bs-toggle="modal" 
              data-bs-target="#detalleSolicitudModal"
              data-solicitud-id="<%= solicitud.solicitud_cambio_id %>"
              data-solicitud-descripcion="<%= solicitud.descripcion %>">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye-fill" viewBox="0 0 16 16">
                <path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0"/>
                <path d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8m8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7"/>
              </svg>
            </button>
          </td>
        </tr>
      <% } %>
    </tbody>
  </table>
</div>
</main>

<!-- Modal para Detalles -->
<div class="modal fade" id="detalleSolicitudModal" tabindex="-1" aria-labelledby="detalleSolicitudModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="detalleSolicitudModalLabel">Detalles de Solicitud #<span id="modalSolicitudId"></span></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label class="form-label"><strong>Descripción:</strong></label>
          <div class="p-3 bg-light rounded" id="modalSolicitudDescripcion"></div>
        </div>
        <div class="row">
          <div class="col-md-6">
            <label class="form-label"><strong>IVD ID:</strong></label>
            <p id="modalSolicitudIvdId"></p>
          </div>
          <div class="col-md-6">
            <label class="form-label"><strong>Fecha y Hora:</strong></label>
            <p id="modalSolicitudFecha"></p>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>

<script>
// Configuración del modal
document.getElementById('detalleSolicitudModal').addEventListener('show.bs.modal', function(event) {
  const button = event.relatedTarget;
  const solicitudId = button.getAttribute('data-solicitud-id');
  const descripcion = button.getAttribute('data-solicitud-descripcion');
  const ivdId = button.closest('tr').querySelector('td:nth-child(2)').textContent;
  const fechaHora = button.closest('tr').querySelector('td:nth-child(3)').textContent;
  
  document.getElementById('modalSolicitudId').textContent = solicitudId;
  document.getElementById('modalSolicitudDescripcion').textContent = descripcion;
  document.getElementById('modalSolicitudIvdId').textContent = ivdId;
  document.getElementById('modalSolicitudFecha').textContent = fechaHora;
});
</script>
</body>
</html>